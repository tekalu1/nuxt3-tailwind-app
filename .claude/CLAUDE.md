@../AGENTS.md

---

## 必須チェックポイント（コード変更前）

> **警告: 以下のプロセスを完了せずにコードを変更することは禁止されています**

コードを変更する前に、AGENTS.mdに記載された開発プロセスが守られているか確認してください：

| ステップ | 確認内容 | 成果物の場所 | 担当エージェント |
|---------|---------|-------------|----------------|
| 1. 計画作成 | 変更の目的、影響範囲、タスク分割が定義されているか？ | `docs/plans/` | `planner` |
| 2. 要件定義 | 機能要件（FR-XXX-NNN）が定義されているか？ | `docs/requirements/` | `requirements-engineer` |
| 3. テスト作成 | テストシナリオ・テストケースが定義されているか？ | `docs/test/` または テストコード | `test-engineer` |
| 4. テスト実施 | テストコードが実装され、実行可能か？ | `tests/` | `test-engineer` |
| 5. 実装 | **上記1〜4が完了してから**コード変更を行う | `components/`, `pages/`, etc. | `developer` |

### 例外（上記プロセスなしで変更可能なケース）

以下の **仕様に影響しない変更のみ** 、プロセスなしで直接変更が可能です：
- タイポ修正（誤字脱字の修正）
- コメントの追加・修正（コードの動作に影響しないもの）
- フォーマット修正（インデント、空白行など）

> **注意**: 上記以外の変更（バグ修正、軽微な修正を含む）は、現状の仕様定義と異なる場合、必ず仕様を先に修正してください。

### 違反時の対応

もしこのチェックポイントを飛ばしてコード変更を行おうとした場合：
1. 即座に作業を停止する
2. ユーザーに報告し、正しいプロセスで再開する

---

## 工程完了時のレビュー依頼（必須）

> **重要: 各工程が完了したら、必ずユーザーにレビューを依頼してください。勝手に次の工程に進んではいけません。**

### レビュー依頼のタイミング

| 工程 | レビュー依頼タイミング | 次の工程 |
|------|------------------------|----------|
| 計画作成 | 計画ドキュメント作成後 | 要件定義 |
| 要件定義 | 機能要件書作成後 | テストシナリオ作成 |
| テストシナリオ作成 | テストシナリオ定義後 | 実装 |
| 実装 | 機能実装完了後 | テスト実施 |
| テスト実施 | テスト作成・実行完了後 | 受け入れ確認 |
| 受け入れ確認 | 全検証完了後 | 完了 |

### レビュー依頼フォーマット

各エージェントは工程完了時に以下の形式でレビューを依頼してください：

```markdown
---
## レビュー依頼

### 完了した工程
{工程名}（例：計画作成、要件定義、実装など）

### 成果物
- {作成/更新したファイルパス}
- {作成/更新したファイルパス}

### 主な内容
{成果物の概要を2〜3行で説明}

### 確認ポイント
- [ ] {ユーザーに確認してほしい項目1}
- [ ] {ユーザーに確認してほしい項目2}
- [ ] {ユーザーに確認してほしい項目3}

### 次の工程
{承認後に進む工程の説明}

---
ご確認いただき、問題なければ次の工程に進めます。
修正が必要な場合はお知らせください。
```

### 注意事項

- レビュー依頼なしに次の工程に進むことは禁止
- ユーザーから明示的な承認（「OK」「進めて」「問題ない」など）を得てから次へ進む
- 修正依頼があった場合は修正後、再度レビューを依頼する

---

## サブエージェント活用ガイド

本プロジェクトでは `.claude/agents/` 配下に専門エージェントが用意されています。
**適切な場面で積極的にサブエージェントを使用し、可能な限り並列実行してください。**

### 利用可能なエージェント

| エージェント | 用途 |
|-------------|------|
| `planner` | 事前調査（現状分析・影響範囲特定・技術調査）+ 実装計画作成、docs/plans/配下へのドキュメント作成 |
| `requirements-engineer` | 機能要件定義書の作成、画面・機能単位の要件整理、テストシナリオとの連携 |
| `developer` | コンポーネント作成、Piniaストア実装、Tailwindスタイリング、Nuxt 3開発全般 |
| `refactor-engineer` | コード・ドキュメントのリファクタリング計画と実行、構造改善、移行作業 |
| `test-engineer` | ユニットテスト、統合テスト、E2Eテストの作成・実施。シナリオ・パターンの網羅性確認 |
| `product-owner` | 実装完了後の受け入れ確認、要件充足・テスト・ドキュメントの最終検証 |

### エージェント使用の判断基準

以下の場合は **必ず** 該当エージェントを使用してください：

**planner を使用する場面:**
- 新機能の追加（複数フェーズが必要な場合）
- 既存機能の大規模改修
- リファクタリングプロジェクト
- 技術的な移行作業
- 影響範囲が不明な変更

**重要:** 改修案件や新機能追加の場合、**まず `planner` で事前調査と計画作成を行ってください。**
plannerは以下の2フェーズを実行します：
1. **事前調査**: 現状分析、影響範囲特定、技術調査、リスク特定
2. **計画作成**: 調査結果に基づくタスク分割とスケジュール

これにより以下の完全な開発フローが確立されます：

```
planner（事前調査 + 計画作成）
    ↓
requirements-engineer（要件定義）
    ↓
test-engineer（テストシナリオ作成）
    ↓
developer（機能実装）
    ↓
test-engineer（テスト実施・追加）
    ↓
product-owner（受け入れ確認）
```

**requirements-engineer を使用する場面:**
- 新機能の要件定義（計画作成後に実施）
- 画面・機能単位の機能要件書作成
- 既存機能の要件ドキュメント化
- 要件変更時の更新

**developer を使用する場面:**
- Vueコンポーネントの新規作成・修正
- Piniaストアの作成・更新
- Tailwind CSSによるスタイリング作業
- ページやレイアウトの実装

**refactor-engineer を使用する場面:**
- 複数ファイルにまたがる構造変更
- コードの共通化・整理
- Atomic Designへの再編成
- ドキュメントの大規模更新
- APIパターンや状態管理の移行

**test-engineer を使用する場面:**
- ユニットテスト（UT）の作成・実施
- 統合テスト（IT）の作成・実施
- E2Eテストの作成・実施
- 新機能追加後のテスト網羅性確認
- バグ修正後の回帰テスト作成
- UI↔バックエンド整合性テストの作成

**重要:** 機能実装後は必ず `test-engineer` を使用してテストを作成・実施してください。
以下のシナリオ・パターンを網羅するテストが自動的に考慮されます:
- 登録確認テスト（何が実装されているべきか）
- ユーザーフローベーステスト（実際の操作シミュレーション）
- エラーパステスト（異常系の網羅）
- 境界値テスト（エッジケースの確認）

**product-owner を使用する場面:**
- 機能実装・テスト完了後の受け入れ確認
- 計画のすべてのタスクが完了した時
- リリース前の最終検証
- 要件充足・テスト・ドキュメントの確認

**重要:** 開発フローの最後に `product-owner` で受け入れ確認を行ってください。
以下の観点で検証が行われます:
- 計画のすべてのタスクが完了しているか
- 機能要件（FR-XXX-NNN）がすべて満たされているか
- テストがすべてパスしているか
- ドキュメントが更新されているか

### 並列実行の原則

**複数の独立したタスクがある場合、必ず並列でサブエージェントを起動してください。**

```
良い例（並列実行）:
ユーザー: "ボタンコンポーネントとカードコンポーネントを作成して"
→ 2つの developer エージェントを同時に起動

良い例（並列実行）:
ユーザー: "商品一覧ページと商品詳細ページを作成して"
→ 2つの developer エージェントを同時に起動

良い例（並列実行）:
ユーザー: "ユーザーストアとカートストアを作成して"
→ 2つの developer エージェントを同時に起動

良い例（実装＋テスト）:
ユーザー: "新しいツールを追加して、テストも書いて"
→ まず developer で実装 → 完了後 test-engineer でテスト作成

良い例（計画→要件定義→テスト→実装→受け入れの完全フロー）:
ユーザー: "ユーザー認証機能を追加したい"
→ planner で計画作成 → requirements-engineer で要件定義 → test-engineer でテストシナリオ
→ developer で実装 → test-engineer でテスト実施 → product-owner で受け入れ確認
```

### 依存関係がある場合

タスク間に依存関係がある場合のみ順次実行してください：

```
順次実行が必要な例:
ユーザー: "ボタンコンポーネントを作成し、それを使ったフォームを作成して"
→ まずボタンを作成 → 完了後にフォームを作成
```

### 注意事項

- 単純な1ファイルの編集や小さな修正には、エージェントを使わず直接対応して構いません
- エージェントの結果はユーザーに要約して報告してください
- 複数エージェントを起動する際は、**必ず単一のメッセージ内で複数のTaskツールを呼び出してください**
- **新しいエージェントを追加した場合は、必ずこのファイル（`.claude/CLAUDE.md`）の「利用可能なエージェント」テーブルと「エージェント使用の判断基準」セクションを更新してください**

---

## Worktree運用時の注意

本プロジェクトではAI並行開発のためにgit worktreeを使用する場合があります。

### 作業ディレクトリの確認

作業開始時に、現在のディレクトリがどのworktree/ブランチなのかを確認してください：

```bash
git branch --show-current
pwd
```

### worktree使用時のルール

1. **指定されたworktreeでのみ作業**: 別のworktreeのファイルを直接編集しない
2. **ブランチの目的を理解**: 担当する機能のスコープ外の変更は行わない
3. **コミット前チェック**: 通常のチェックリストに加え、正しいブランチか確認

### 他worktreeとの連携が必要な場合

依存関係が発生した場合は、ユーザーに報告し判断を仰いでください：

- 「feature-authの認証機能が必要ですが、まだマージされていません」
- 「共通コンポーネントの変更が必要ですが、mainで行うべきですか？」
